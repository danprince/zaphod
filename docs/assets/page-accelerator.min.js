(function(t){var e=t._PageAccelerator=t._PageAccelerator||{};e.ajax={get:function(e){return new t.Promise(function(t,r){var a=new XMLHttpRequest;a.open("GET",e,true);a.onload=function(){if(a.status>=200&&a.status<400){t(a.response);return}r(a.response)};a.onerror=function(){r(Error("Network Error"))};a.send()})}}})(window);(function(t,e){if(typeof exports==="object"&&exports){e(exports)}else if(typeof define==="function"&&define.amd){define(["exports"],e)}else{e(t)}})(this,function(t){var e=t===window;var r=e?t:window;var a=document;var n=r._PageAccelerator=r._PageAccelerator||{};n.PageAccelerator=function(){this.url=a.location.href;this.beforeLoading=function(){};this.afterLoading=function(){};this.metaKeyIsPressed=false};n.PageAccelerator.prototype={_updateObject:function(t,e){var r=e.attributes;for(var a=0,n=r.length;a<n;a++){t.attrs[r[a].name]=r[a].value}return t},_updateHistory:function(t,e){var a=this._updateObject({head:t.innerHTML.trim(),content:e.innerHTML.trim(),attrs:{}},e);r.history.pushState(a,"",this.url);r.addEventListener("popstate",this._updateBody.bind(this),false)},_DOMParser:function(t){var e=new DOMParser;return e.parseFromString(t,"text/html")},_updateBodyAttributes:function(t){Object.keys(t).forEach(function(e){var r=t[e];a.body.setAttribute(e,r)})},_updateBody:function(t){this.beforeLoading();var e=t.state;this._updateBodyAttributes(e.attrs);a.body.innerHTML=e.content;var n=this._DOMParser(e.head);a.title=n.head.querySelector("title").innerText;this.url=r.location.href;this.start();this.afterLoading()},_loadStyles:function(t,e){var a=[].map.call(t.querySelectorAll('link[rel="stylesheet"]'),function(t){return n.ajax.get(t.getAttribute("href"))});r.Promise.all(a).then(e.bind(this))},_update:function(t){var e=this._DOMParser(t);var n=e.head;this._loadStyles(n,function(){var t=e.body;a.body=t;a.head=n;a.title=n.querySelector("title").innerText;this._updateHistory(n,t);this.afterLoading();r.scrollTo(0,0);this.start()}.bind(this))},_onClick:function(t){this.beforeLoading();this.url=t.href;n.ajax.get(this.url).then(this._update.bind(this)).catch(this._update.bind(this))},_replaceHistory:function(){var t=a.body;var e=this._updateObject({head:a.head.innerHTML.trim(),content:t.innerHTML.trim(),attrs:{}},t);r.history.replaceState(e,"",this.url)},start:function(t){var e=t||{};this.beforeLoading=e.beforeLoading||this.beforeLoading;this.afterLoading=e.afterLoading||this.afterLoading;var n=this;var i=a.querySelectorAll('a:not([data-pageAccelerator="false"])');[].forEach.call(i,function(t){if(t.hostname!==r.location.hostname||t.protocol!==r.location.protocol||/#/.test(t.href)){return}t.addEventListener("click",function(t){if(!n.metaKeyIsPressed){t.preventDefault();n._onClick.call(n,this)}},false)});window.addEventListener("keydown",function(t){if(t.metaKey||t.ctrlKey){n.metaKeyIsPressed=true}});window.addEventListener("keyup",function(t){if(t.metaKey||t.ctrlKey){n.metaKeyIsPressed=false}});this._replaceHistory()}};t.pageAccelerator=function(t){(new n.PageAccelerator).start(t)}});